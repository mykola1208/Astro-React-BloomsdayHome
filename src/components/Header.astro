---
import { Icon } from "astro-icon/components";
import SearchBox from "./SearchBox.astro";
import { UserButton } from "astro-clerk-auth/components/interactive";
import stream from "getstream";
import NotificationBell from "../components/react/NotificationBell.jsx"

const user = await Astro.locals.currentUser();
const userToken =
  user.publicMetadata.streamToken ||
  stream
    .connect(
      import.meta.env.PUBLIC_GETSTREAM_FEED_KEY,
      import.meta.env.GETSTREAM_FEED_SECRET,
      import.meta.env.PUBLIC_GETSTREAM_APP_ID
    )
    .createUserToken(user.id);

---

<div class="flex flex-row py-4 px-8">
  <div class="basis-1/5 flex items-center">
    <Icon name="logo" width={185} height={34} />
  </div>
  <div class="basis-3/5">
    <SearchBox />
  </div>
  <div class="basis-1/5 flex items-center justify-end gap-x-3">
    <button type="button" class="inline-flex items-center p-3.5">
      <Icon name="settings" width={24} height={25} />
    </button>
    <button type="button" class="inline-flex items-center p-3.5">
      <!-- <Icon name="alert" width={25} height={25} /> -->
      <NotificationBell token={userToken} client:only="react" />
    </button>
    <UserButton />
  </div>
</div>

<script>
  window.global = window;
</script>

