---
import { Icon } from "astro-icon/components";
import BreadCrumbs from "./BreadCrumbs.astro";
import { getAddress } from "../pages/api/getAddress";
import EditAddressForm from "./react/EditAddressForm";
const graphqlEndpoint = import.meta.env.PUBLIC_HASURA_BASE_URL;
const token = await Astro.locals.auth().getToken({ template: "hasura" });

const { breadcrumbs } = Astro.props;
const address = await getAddress(graphqlEndpoint, token);
---

<div class="py-7 px-6">
  <div class="neue text-darkgreen text-lg font-bold leading-5">
    <BreadCrumbs breadcrumbs={breadcrumbs} class="shrink-0" />
  </div>
  <div class="pr-4 pt-2 gap-4 mt-4 flex">
    <Icon name="myhouse" width={58} height={55} />
    <div class="flex flex-col items-baseline">
      <div class="flex">
        <p class="text-base leading-4 text-darkgreen mt-3.5 font-medium">
          My Home
        </p>
        <button id="addressFrom" class="flex ml-2 mt-2">
          <Icon name="edit" width={20} height={21} />
        </button>
        <EditAddressForm client:only="react" address={address} />
      </div>

      <p id="showAddress" class="text-1.5xl font-medium text-darkgreen">
        {
          address.address1
            ? `${address.address1}, ${address.city}, ${address.state} ${address.zip5}`
            : "Street, City, State 00000"
        }
      </p>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", (event) => {
    const buttonElement = document.getElementById("addressFrom");
    buttonElement.addEventListener("click", () => {
      const element = document.getElementById("editForm");
      if (element) {
        element.classList.toggle("hidden");
        element.classList.toggle("visible");
      } else {
        console.error('Element with ID "editForm" not found');
      }
    });
  });
</script>
